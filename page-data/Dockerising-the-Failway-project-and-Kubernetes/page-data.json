{"componentChunkName":"component---node-modules-gatsby-theme-blog-core-src-templates-post-query-js","path":"/Dockerising-the-Failway-project-and-Kubernetes/","result":{"data":{"site":{"siteMetadata":{"title":"Gary Spencers Blog","social":[{"name":"twitter","url":"https://twitter.com/gspncr"},{"name":"github","url":"https://github.com/gspncr"}]}},"blogPost":{"__typename":"MdxBlogPost","id":"d460e838-5a9c-57b6-9999-3b77487fe968","excerpt":"At last I worked on dockerising the Failway Project. I have also released the  source code on Github  and published the  image on DockerHub…","body":"function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"title\": \"Dockerising the Failway project and Kubernetes\",\n  \"date\": \"2018-11-16T00:00:00.000Z\"\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, [\"components\"]);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, \"At last I worked on dockerising the Failway Project. I have also released the \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/gspncr/failway\"\n  }), \"source code on Github\"), \" and published the \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://hub.docker.com/r/gspncr/failway/\"\n  }), \"image on DockerHub\"), \"!\"), mdx(\"p\", null, \"I started the Failway project a while ago and there is still more to come. The changes here are minor on software, and all about deployment ease. The only software switch was no longer using Flask Logging but \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://docs.python.org/3/library/logging.html\"\n  }), \"Python\\u2019s native Logging library\"), \" which made life easier than using Flask for that.\"), mdx(\"h1\", {\n    \"id\": \"source-code\"\n  }, \"Source code\"), mdx(\"p\", null, \"As I pointed out the source code is on GitHub. It is still not in a tidy state, but useable. Logging is rewritten so the app can run seamlessly. I am going to change the logging again in favour of a logging stream so I can ingest this easier in Kubernetes, I will publish this as a separate branch.\"), mdx(\"p\", null, \"The station path is still one way. I think the most portable way to address it is to set the from and to stations using environment variables. I am still yet to build this for an entire route or give the ability to choose in the interface which is my next step.\"), mdx(\"p\", null, mdx(\"span\", _extends({\n    parentName: \"p\"\n  }, {\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"1024px\"\n    }\n  }), \"\\n      \", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"60%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAA7EAAAOxAGVKw4bAAABgElEQVQoz4WSW0vDQBCF8/9/iiiKoL6orxW8IYLog1YFW68x3fs1x9ndtKaxauBjJpvsmbMzW+2eT7AxGmPz6B5bx4/YvnjG+um0cPaMtZMJti7esHPVYO+a4XBscXBnfkLr+7caVTQcavaeEZ+vGck/M4bVcLwGrAAQ8P8TUM0Yx/tHDcYFhFSQSoNLDUHROA9jHTThfMxYFyguE0Ip5r1HJZUCEwKcM4J3lJwxhqZpIKWENhJS02koCq0LVFRSnDYMo/snjN9qVJoWUoWkPiQEv/gmDSORhgQFGAklZh0PNfX35g6Xk5cimBwkR0JIOkIRGRJj2xHRdkRaZ9pAWZv3WYpZsG3bP1kItTHHkreLPBFizKKVMSYfyTn3K8rYjKdcmjIk70ssedmfh5JsDqvNHViaoKB2KBqcyIPjSAb6rkPouaQWVOnHtCFX8W7J7apB9Z0ngX5ryrUhB99DEUg9Ta7nGNPPzRLDopbes2ByOBdOP/av0SJfMfmh+yT4BSoBocu7+Wz5AAAAAElFTkSuQmCC')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  })), \"\\n  \", mdx(\"img\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"dtlogs\",\n    \"title\": \"dtlogs\",\n    \"src\": \"/static/584680169fa321961874b09229635957/2bef9/dtlogs.png\",\n    \"srcSet\": [\"/static/584680169fa321961874b09229635957/e4d6b/dtlogs.png 345w\", \"/static/584680169fa321961874b09229635957/1e043/dtlogs.png 690w\", \"/static/584680169fa321961874b09229635957/2bef9/dtlogs.png 1024w\"],\n    \"sizes\": \"(max-width: 1024px) 100vw, 1024px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  })), \"\\n    \"), \"\\nThe logging also appears very nicely in Dynatrace as you can see above. FYI, those logs discovered automatically, and agent injection automatically handled with the OneAgent operator in Kubernetes.\"), mdx(\"h1\", {\n    \"id\": \"docker-image\"\n  }, \"Docker image\"), mdx(\"p\", null, \"I published a pre built image to Docker Hub at gspncr/failway which includes the route from West Hampstead Thameslink to Luton Airport Parkway (my old commute before I moved).\"), mdx(\"p\", null, \"The Dockerfile is published to Github too. The Dockerfile works in the /app/ directory and works by copying the raw files from Failway on Github into the /app/ directory. It also installs the Python dependencies using pip. It is exposed on port 80.\\n\", mdx(\"span\", _extends({\n    parentName: \"p\"\n  }, {\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"1024px\"\n    }\n  }), \"\\n      \", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"48.69565217391305%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAA7EAAAOxAGVKw4bAAABpElEQVQoz2VSWW7VQBD0/W/BpizKLxJHQBBBICL5YAuI8OK32OPZVxfd7YeJhOVS1fRSnmlP9+L1A07e9Dh9u8XZ5Q5nzIQTWS98fq1x/snhyXuDp4TnHyyeHbHqK9IfHbo5aGQ7AMkCaPj/KfT6o3RUZ0jMx9p21JlkEN31+xGb7QH9YSQo7JXGqCZMxiKVChcCaQeXKgZtsRs1bCowMcOELFr7iMF4qem+bhW+7Sb8miLuCd+HgKuNx3UfcLvPom96iwdXcXcwUruxBb9NFtzrhJ+jxw/CGMhQNj/Psht+dq7h4jbi5eeIV18iLm4C3m2K5HJphAoqlx7uTTkjpiR5jnUcaG2WBXOpZDz/nc2CRutUyYzyzDE3hPgYszD3d5FmNPPX2mKiXMBAMzTew/oA7YipxpHmeSqal48VmZBWFORUxadrjZ3bYkqIdKSQi8CnvLINUZhRpb6h0mlq+wcxtNZjmhQU/9lpgtZ6ZcNaKXi/XJsYIwqNiPMc4yOyKW+Ic8ydoaswjuMKRQaP9TAMMHSFuNE5J40cZ82xUoqAP8DrP3xE/pnsNv7uAAAAAElFTkSuQmCC')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  })), \"\\n  \", mdx(\"img\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"dtmemory\",\n    \"title\": \"dtmemory\",\n    \"src\": \"/static/a59663a12b40de94afaf7ccf12bd4ec3/2bef9/dtmemory.png\",\n    \"srcSet\": [\"/static/a59663a12b40de94afaf7ccf12bd4ec3/e4d6b/dtmemory.png 345w\", \"/static/a59663a12b40de94afaf7ccf12bd4ec3/1e043/dtmemory.png 690w\", \"/static/a59663a12b40de94afaf7ccf12bd4ec3/2bef9/dtmemory.png 1024w\"],\n    \"sizes\": \"(max-width: 1024px) 100vw, 1024px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  })), \"\\n    \")), mdx(\"h1\", {\n    \"id\": \"kubernetes\"\n  }, \"Kubernetes\"), mdx(\"p\", null, \"The best way to run this (and almost anything else) is using Kubernetes. The main reason in my case is National Rail\\u2019s frequent banning of the calling IP and the ban lasts for 60 minutes at a time. By having a good enough ReplicaSet and number of pods this can be avoided.\"), mdx(\"p\", null, \"I am working on (immediate next task) a Kubernetes yaml file, and I want to include a health endpoint to check for when the k8s node is banned by NR and to remove it from handling traffic (user will see a HTTP 500 (now also handled)).\\n\", mdx(\"span\", _extends({\n    parentName: \"p\"\n  }, {\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"1024px\"\n    }\n  }), \"\\n      \", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"52.7536231884058%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAA7EAAAOxAGVKw4bAAABvElEQVQoz42R3WvUQBTF888LKohvgoogaMGHUl1bi+BLS2ul+OAH+KLuZmV34yaZmUwyk8nXJsd7J1VbbdELP+7M5Obcc2eC29sp7kwE7u9JPNhXuPXkG649/Iwbj2d/cXMrJOa4/mhGdQvc3ZWEwD2CM+sETw9W2DmI8OxwjedHa+ydSOyeZIQa8+sxT44F1cXYOYwxOUqpTuHFG4mXpwr7lF+9pdrjBIHVMbpKo29yn4EBl0cPZxI0VUHrzdnZcA6OGsE0XCD6vkaSCuR5gU0/oKf6dZlCciNad5sBTdthsYzwaWbxcVbhw9Th/deRd19K2lcQWYkgSRIIkcIYA11o5C6HcQapEVBWoXAFTG2Rm5wa5vSTJSpIXSGR1mehHbKigco0gjAMkaYptNYoyxJN04zUI3Vd/4LPu/Y3bVOjbRnadw0smQrm8zlWq5UXZZd938Nae+ktDsPwBzhjvMOqqhCwWJZl4NGZruvATaIoQlEU1L29QuwiHM45epTp1LsTQniH/JHFuAm7Zf4ldkEwjmMvyCyXS3+X/IGdsjsW/N/wI0spoZTygjwyO/vZgJvx/vzDXAU/GE/4A+jtOvTLYkcVAAAAAElFTkSuQmCC')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  })), \"\\n  \", mdx(\"img\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"kube\",\n    \"title\": \"kube\",\n    \"src\": \"/static/5e025c58a0e6f9c6892581080d6b819f/2bef9/kube.png\",\n    \"srcSet\": [\"/static/5e025c58a0e6f9c6892581080d6b819f/e4d6b/kube.png 345w\", \"/static/5e025c58a0e6f9c6892581080d6b819f/1e043/kube.png 690w\", \"/static/5e025c58a0e6f9c6892581080d6b819f/2bef9/kube.png 1024w\"],\n    \"sizes\": \"(max-width: 1024px) 100vw, 1024px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  })), \"\\n    \")), mdx(\"h1\", {\n    \"id\": \"future\"\n  }, \"Future\"), mdx(\"p\", null, \"I want to evaluate IaaS providers container services. In Kubernetes the node IP address will not change so frequently. A nice/lazy workaround is to have a pool of at least two container services hosting Failway, and introduce a load balancer ahead of the downstream container services, and when the containers have their individual IPs banned by National Rail are destroyed and returned to the pool with a new IP address. This means less downtime because of the IP situation. Of course in an ideal world I rework the batch job script which was the first design of Failway and keep a cache up to date. I will look at it again but it had two main problems, first that the results are quickly out of date, the second is it is expensive to keep the cache up to date; but having that cache would avoid the IPs being banned but the tradeoff is not accurate results from National Rail.\"));\n}\n;\nMDXContent.isMDXComponent = true;","slug":"/Dockerising-the-Failway-project-and-Kubernetes/","title":"Dockerising the Failway project and Kubernetes","tags":[],"date":"November 16, 2018","image":null,"imageAlt":null,"imageCaptionText":null,"imageCaptionLink":null,"socialImage":null},"previous":{"__typename":"MdxBlogPost","id":"7f139c23-97b4-5458-a67f-d04576c10e06","excerpt":"We started using Microsoft Teams at work. A friend that works at Microsoft told me a cool way to access MS Teams, using  http://slack.fail…","slug":"/Monitoring-the-Thameslink-Failway/","title":"Monitoring the Thameslink Failway","date":"January 06, 2018"},"next":{"__typename":"MdxBlogPost","id":"a0f7d29e-923c-5223-8a5b-124d63986cd2","excerpt":"Azure Container Registry is a private Docker registry for your Docker images. The registry can be replicated across regions automatically…","slug":"/Using-Azure-Container-Registry-in-Kubernetes/","title":"Using Azure Container Registry in Kubernetes","date":"February 02, 2019"}},"pageContext":{"id":"d460e838-5a9c-57b6-9999-3b77487fe968","previousId":"7f139c23-97b4-5458-a67f-d04576c10e06","nextId":"a0f7d29e-923c-5223-8a5b-124d63986cd2","maxWidth":1380}},"staticQueryHashes":["2744905544","3090755652","386998304","764694655"]}