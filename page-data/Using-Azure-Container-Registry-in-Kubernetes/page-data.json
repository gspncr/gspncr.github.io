{"componentChunkName":"component---node-modules-gatsby-theme-blog-core-src-templates-post-query-js","path":"/Using-Azure-Container-Registry-in-Kubernetes/","result":{"data":{"site":{"siteMetadata":{"title":"Gary Spencers Blog","social":[{"name":"twitter","url":"https://twitter.com/gspncr"},{"name":"github","url":"https://github.com/gspncr"}]}},"blogPost":{"__typename":"MdxBlogPost","id":"a0f7d29e-923c-5223-8a5b-124d63986cd2","excerpt":"Azure Container Registry is a private Docker registry for your Docker images. The registry can be replicated across regions automatically…","body":"function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"title\": \"Using Azure Container Registry in Kubernetes\",\n  \"date\": \"2019-02-02T00:00:00.000Z\"\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, [\"components\"]);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, \"Azure Container Registry is a private Docker registry for your Docker images. The registry can be replicated across regions automatically, keeping the images close to the compute. Azure Container Registry can also be used as a private repository location for your Docker images you do not wish to publish.\"), mdx(\"p\", null, \"I am documenting here the process of how to use a private Azure Container Registry with your Kubernetes environment. There are others out there that I tried and not one of them had the correct method for various things, so I am keeping this here also for my own use \\uD83D\\uDE42\"), mdx(\"h1\", {\n    \"id\": \"step-0-assumptions\"\n  }, \"Step 0: Assumptions\"), mdx(\"p\", null, \"I am assuming you have a registry created in Azure. If you don\\u2019t, do that first (you don\\u2019t actually have to but your intended registry name might be taken so just makes sense to get that first really).\\nCreate your Azure Container Registry \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://portal.azure.com/#create/Microsoft.ContainerRegistry\"\n  }), \"here\"), \".\\nI also am assuming you have Azure Command Line Interface. You need it so get it \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://docs.microsoft.com/en-us/cli/azure/install-azure-cli?view=azure-cli-latest\"\n  }), \"here\"), \".\\nI also am assuming you are signed into a Kubernetes cluster in \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"kubectl\")), mdx(\"h1\", {\n    \"id\": \"step-1-tag-your-image\"\n  }, \"Step 1: Tag your image\"), mdx(\"p\", null, \"Now that your image is built, you must tag it with the location of your registry. You do not have to do anything in Azure at this stage (the register location is made based on the tag). Tag the image with the registry domain followed by the image name (in the form of a URL) like below:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-shell\"\n  }), \"docker tag facility-rating gspncr.azurecr.io/facility-rating\\n\")), mdx(\"h1\", {\n    \"id\": \"step-2-docker-login\"\n  }, \"Step 2: Docker login\"), mdx(\"p\", null, \"Login to the private registry using docker login. The login will check if you already have an Azure CLI session and if you don\\u2019t will prompt you to login. Use the credentials here that you use for logging into the Azure online portal. Like mine below.\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-shell\"\n  }), \"docker login gspncr.azurecr.io\\n\")), mdx(\"h1\", {\n    \"id\": \"step-3-push-to-your-azure-container-registry\"\n  }, \"Step 3: Push to your Azure Container Registry\"), mdx(\"p\", null, \"Now that the image is tagged, you can push it. The speed of this depends on the size of your image build.\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-shell\"\n  }), \"docker push gspncr.azurecr.io/facility-rating\\n\")), mdx(\"h1\", {\n    \"id\": \"step-4-creating-a-secret-in-kubernetes\"\n  }, \"Step 4: Creating a secret in Kubernetes\"), mdx(\"p\", null, \"This is the part that was difficult to find a sensible process anywhere in the web but here I have documented it. What we are doing here is creating a secret that Kubernetes will use to authenticate against the Azure Container Registry. It is much simpler than other sources shown, use my command below, and find below that where to find these details.\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-shell\"\n  }), \"kubectl create secret docker-registry SECRET-NAME --docker-server REGISTRY.azure\\n\")), mdx(\"p\", null, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"SECRET-NAME\"), \" : this can be anything, I named mine az-k8s-auth\\n\", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"REGISTRY.azurecr.io\"), \" : this is the URL for your container registry, e.g.\"), mdx(\"p\", null, mdx(\"img\", _extends({\n    parentName: \"p\"\n  }, {\n    \"src\": \"https://d2ew3xvzve50rf.cloudfront.net/wp-content/uploads/2019/02/27122724/k8s-secrets-1024x506.png\",\n    \"alt\": null\n  }))), mdx(\"p\", null, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"AZURE-EMAIL-ADDRESS\"), \" : quite simply, the email you are signing into Azure with.\\n\", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"ACR-USER\"), \" : In your container registry, go to Access Keys and find Username. Make sure you have Admin User enabled.\\n\", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"ACR-PASSWORD\"), \" : In your container registry, to to Access Keys, copy one of the generated admin passwords.\"), mdx(\"p\", null, mdx(\"img\", _extends({\n    parentName: \"p\"\n  }, {\n    \"src\": \"https://d2ew3xvzve50rf.cloudfront.net/wp-content/uploads/2019/02/27121936/container-registry-access.png\",\n    \"alt\": null\n  }))), mdx(\"h1\", {\n    \"id\": \"step-5-deploy-your-app\"\n  }, \"Step 5: Deploy your app\"), mdx(\"p\", null, \"Now you can deploy to your Kubernetes cluster using Azure Container Registry URL\\u2019s. If you want to learn more of that I have attached steps below.\"), mdx(\"p\", null, mdx(\"img\", _extends({\n    parentName: \"p\"\n  }, {\n    \"src\": \"https://d2ew3xvzve50rf.cloudfront.net/wp-content/uploads/2019/02/27122724/k8s-secrets-1024x506.png\",\n    \"alt\": null\n  }))), mdx(\"p\", null, \"View your secrets in Kubernetes, check the one you created in step 4 is appeared there so that it can be used.\"), mdx(\"p\", null, mdx(\"img\", _extends({\n    parentName: \"p\"\n  }, {\n    \"src\": \"https://d2ew3xvzve50rf.cloudfront.net/wp-content/uploads/2019/02/27122823/az-registry.png\",\n    \"alt\": null\n  }))), mdx(\"p\", null, \"In Azure Container Registry click on Repositories and check that the image you pushed in step 3 is there. Azure does not tell you what is the URL for the repository but it actually is what we specified in the tag earlier. So for mine is gspncr.azurecr.io/failway\"), mdx(\"p\", null, mdx(\"img\", _extends({\n    parentName: \"p\"\n  }, {\n    \"src\": \"https://d2ew3xvzve50rf.cloudfront.net/wp-content/uploads/2019/02/27122941/k8s-gui-deploy-1024x566.png\",\n    \"alt\": null\n  }))), mdx(\"p\", null, \"For deploying in the Kubernetes UI, see you can use the container image URL for the Azure repo. You also must specify the image pull secret otherwise the pod will fail to deploy:\"), mdx(\"p\", null, mdx(\"img\", _extends({\n    parentName: \"p\"\n  }, {\n    \"src\": \"https://d2ew3xvzve50rf.cloudfront.net/wp-content/uploads/2019/02/27123227/azure-secret.png\",\n    \"alt\": null\n  }))), mdx(\"p\", null, \"Where that is hidden inside of \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"advanced options\"), \". Also a pro tip, if you have saved your secret to a namespace, make sure it is the same namespace where you are deploying your application. In this example it is available across all of the namespaces.\"));\n}\n;\nMDXContent.isMDXComponent = true;","slug":"/Using-Azure-Container-Registry-in-Kubernetes/","title":"Using Azure Container Registry in Kubernetes","tags":[],"date":"February 02, 2019","image":null,"imageAlt":null,"imageCaptionText":null,"imageCaptionLink":null,"socialImage":null},"previous":{"__typename":"MdxBlogPost","id":"d460e838-5a9c-57b6-9999-3b77487fe968","excerpt":"At last I worked on dockerising the Failway Project. I have also released the  source code on Github  and published the  image on DockerHub…","slug":"/Dockerising-the-Failway-project-and-Kubernetes/","title":"Dockerising the Failway project and Kubernetes","date":"November 16, 2018"},"next":null},"pageContext":{"id":"a0f7d29e-923c-5223-8a5b-124d63986cd2","previousId":"d460e838-5a9c-57b6-9999-3b77487fe968","maxWidth":1380}},"staticQueryHashes":["2744905544","3090755652","386998304","764694655"]}